<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é™æ€æ–‡ä»¶æµ‹è¯•</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-item {
            background: white;
            padding: 15px;
            margin: 10px 0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .success { color: green; }
        .error { color: red; }
        .loading { color: orange; }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #0056b3;
        }
    </style>
</head>
<body>
    <h1>ğŸ”§ é™æ€æ–‡ä»¶æœåŠ¡æµ‹è¯•</h1>
    
    <div class="test-item">
        <h3>ğŸ“ æ–‡ä»¶è®¿é—®æµ‹è¯•</h3>
        <button onclick="testFile('main.js')">æµ‹è¯• main.js</button>
        <button onclick="testFile('style.css')">æµ‹è¯• style.css</button>
        <button onclick="testFile('storyRenderer.js')">æµ‹è¯• storyRenderer.js</button>
        <button onclick="testFile('index.html')">æµ‹è¯• index.html</button>
        <div id="fileResults"></div>
    </div>
    
    <div class="test-item">
        <h3>ğŸ¥ å¥åº·æ£€æŸ¥</h3>
        <button onclick="testHealth()">æµ‹è¯• /health</button>
        <div id="healthResults"></div>
    </div>
    
    <div class="test-item">
        <h3>ğŸŒ APIæµ‹è¯•</h3>
        <button onclick="testAPI()">æµ‹è¯• /api/generate-story</button>
        <div id="apiResults"></div>
    </div>
    
    <div class="test-item">
        <h3>ğŸ“Š æµ‹è¯•ç»“æœæ±‡æ€»</h3>
        <div id="summary"></div>
    </div>

    <script>
        const results = {
            files: {},
            health: null,
            api: null
        };

        async function testFile(filename) {
            const resultDiv = document.getElementById('fileResults');
            const statusDiv = document.createElement('div');
            statusDiv.innerHTML = `<span class="loading">ğŸ”„ æµ‹è¯• ${filename}...</span>`;
            resultDiv.appendChild(statusDiv);

            try {
                const response = await fetch(`/${filename}`);
                if (response.ok) {
                    statusDiv.innerHTML = `<span class="success">âœ… ${filename} - çŠ¶æ€: ${response.status}</span>`;
                    results.files[filename] = { status: 'success', code: response.status };
                } else {
                    statusDiv.innerHTML = `<span class="error">âŒ ${filename} - çŠ¶æ€: ${response.status}</span>`;
                    results.files[filename] = { status: 'error', code: response.status };
                }
            } catch (error) {
                statusDiv.innerHTML = `<span class="error">âŒ ${filename} - é”™è¯¯: ${error.message}</span>`;
                results.files[filename] = { status: 'error', error: error.message };
            }
            
            updateSummary();
        }

        async function testHealth() {
            const resultDiv = document.getElementById('healthResults');
            const statusDiv = document.createElement('div');
            statusDiv.innerHTML = `<span class="loading">ğŸ”„ æµ‹è¯•å¥åº·æ£€æŸ¥...</span>`;
            resultDiv.appendChild(statusDiv);

            try {
                const response = await fetch('/health');
                if (response.ok) {
                    const data = await response.json();
                    statusDiv.innerHTML = `<span class="success">âœ… å¥åº·æ£€æŸ¥é€šè¿‡ - çŠ¶æ€: ${data.status}</span>`;
                    results.health = { status: 'success', data: data };
                } else {
                    statusDiv.innerHTML = `<span class="error">âŒ å¥åº·æ£€æŸ¥å¤±è´¥ - çŠ¶æ€: ${response.status}</span>`;
                    results.health = { status: 'error', code: response.status };
                }
            } catch (error) {
                statusDiv.innerHTML = `<span class="error">âŒ å¥åº·æ£€æŸ¥é”™è¯¯: ${error.message}</span>`;
                results.health = { status: 'error', error: error.message };
            }
            
            updateSummary();
        }

        async function testAPI() {
            const resultDiv = document.getElementById('apiResults');
            const statusDiv = document.createElement('div');
            statusDiv.innerHTML = `<span class="loading">ğŸ”„ æµ‹è¯•API...</span>`;
            resultDiv.appendChild(statusDiv);

            try {
                const response = await fetch('/api/generate-story', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ input: 'test' })
                });
                
                if (response.ok) {
                    statusDiv.innerHTML = `<span class="success">âœ… APIæµ‹è¯•é€šè¿‡ - çŠ¶æ€: ${response.status}</span>`;
                    results.api = { status: 'success', code: response.status };
                } else {
                    statusDiv.innerHTML = `<span class="error">âŒ APIæµ‹è¯•å¤±è´¥ - çŠ¶æ€: ${response.status}</span>`;
                    results.api = { status: 'error', code: response.status };
                }
            } catch (error) {
                statusDiv.innerHTML = `<span class="error">âŒ APIæµ‹è¯•é”™è¯¯: ${error.message}</span>`;
                results.api = { status: 'error', error: error.message };
            }
            
            updateSummary();
        }

        function updateSummary() {
            const summaryDiv = document.getElementById('summary');
            let summary = '<h4>æµ‹è¯•ç»“æœæ±‡æ€»:</h4>';
            
            // æ–‡ä»¶æµ‹è¯•ç»“æœ
            summary += '<h5>ğŸ“ æ–‡ä»¶è®¿é—®:</h5>';
            Object.keys(results.files).forEach(filename => {
                const result = results.files[filename];
                const icon = result.status === 'success' ? 'âœ…' : 'âŒ';
                summary += `<div>${icon} ${filename}: ${result.status} (${result.code || result.error})</div>`;
            });
            
            // å¥åº·æ£€æŸ¥ç»“æœ
            if (results.health) {
                summary += '<h5>ğŸ¥ å¥åº·æ£€æŸ¥:</h5>';
                const icon = results.health.status === 'success' ? 'âœ…' : 'âŒ';
                summary += `<div>${icon} ${results.health.status} (${results.health.code || results.health.error})</div>`;
            }
            
            // APIæµ‹è¯•ç»“æœ
            if (results.api) {
                summary += '<h5>ğŸŒ APIæµ‹è¯•:</h5>';
                const icon = results.api.status === 'success' ? 'âœ…' : 'âŒ';
                summary += `<div>${icon} ${results.api.status} (${results.api.code || results.api.error})</div>`;
            }
            
            summaryDiv.innerHTML = summary;
        }

        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨æµ‹è¯•
        window.addEventListener('load', () => {
            setTimeout(() => {
                testFile('main.js');
                testFile('style.css');
                testHealth();
            }, 1000);
        });
    </script>
</body>
</html>
